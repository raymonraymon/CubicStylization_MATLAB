%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%     Copyright (C) 2020 Zaiwen Wen, Haoyang Liu, Jiang Hu
% 
%     This program is free software: you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation, either version 3 of the License, or
%     (at your option) any later version.
% 
%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.
% 
%     You should have received a copy of the GNU General Public License
%     along with this program.  If not, see <https://www.gnu.org/licenses/>.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% ?????????????
% ????????
%
% $$ \min\|x\|_1,\quad \mathrm{s.t.}\quad Ax=b,$$
% 
% ???????????????????????????????????? LASSO ???
% 
% $$\min \|x\|_1+\frac{\sigma}{2}\|Ax-b\|^2, $$
% ?? $\sigma$ ????? 
% 
% ? $\mu = \frac{1}{\sigma}$???????????????? LASSO ???? $\mu$
% ???????? LASSO ???????????? $\mu$ ?? $0$ ? LASSO 
% ??????? BP ???????????????? $\mu$??????????????????????????? $\mu$
% ????????
%% ?? LASSO ??
clear;
%%%
% ???????
seed = 97006855;
ss = RandStream('mt19937ar','Seed',seed);
RandStream.setGlobalStream(ss);
%%%
% ?? LASSO ????
% 
% $$ \min_x f(x) :=\frac{1}{2}\|Ax-b\|_2^2 + \mu\|x\|_1, $$
% 
% ??????? $A$ ??? $u$ ??? $b=Au$?
m = 512;
n = 1024; 
A = randn(m, n);
u = sprandn(n, 1, 0.1);
b = A * u;
x0 = zeros(n, 1);

%% ????
% ?????????? LASSO ???????????? $\mu=10$ ??? $\gamma = 10^{-1}$
% ?????? $\mu=10^{-3}$????????????????????? $\mu$??? LASSO ????????????????????
opts = struct();
opts.maxit = 600;
opts.alpha0 = 0.0002; 
%%%
% ??????????????? |f_val| ??????? $\frac{f(x)}{\mu}$ ??? |g_val| ??????? $\frac{\|Ax^k-b\|}{\|b\|}$ ???
opts.step_type = 'fixed';
x = x0;
f_val = [];
g_val = [];
for mu = [10, 1, 1e-1, 1e-2, 1e-3]
    addpath('../lasso_subgrad');
    [x, out] = l1_subgrad(x, A, b, mu, opts);
    f_val = [f_val, out.f_hist_best(1:out.itr) / mu];
    g_val = [g_val, out.g_hist(1:out.itr) / norm(b)];
end

%% ????? LASSO ??
% ???????????? $\mu=10^{-3}$?? LASSO ??????????????????????LASSO ???????
% ??????????
opts.maxit = numel(f_val);
opts.ftol = 0;
[x1, out] = l1_subgrad(x0, A, b, 1e-3, opts);
f_val1 = out.f_hist_best / 1e-3;
g_val1 = out.g_hist / norm(b);

%% ?????
fig1 = figure;
x = 1:numel(f_val);
semilogy(x, f_val, 'k-', x, f_val1, 'k--');
legend('pen fun', 'subgrad');
ylabel('$\hat{f}^k/\mu$', 'fontsize', 14, 'interpreter', 'latex');
xlabel('iter times');
print(fig1, '-depsc','penalty1.eps');

fig2= figure;
semilogy(x, g_val, 'k-', x, g_val1, 'k--');
legend('pen fun', 'subgrad');
ylabel('$\|Ax^k - b\|/\|b\|$', 'fontsize', 14, 'interpreter', 'latex');
xlabel('iter times');
print(fig2, '-depsc','penalty2.eps');

%% ????
% ???????????????????????????????????
% ???????? $\mu$????????? $Ax = b$??????
% ????????????? $\|x\|_1$????????? $\mu$ ?????
% ????????????( $\|Ax -b\|_2$???)???? $\mu = 10^{-3}$?????
% ??????? $\|Ax -b\|_2^2$???????????????????? $Ax = b$????? $\|x\|_1$?????

%% ????
% ????????? $\lambda$ ? LASSO ??????????
% <../lasso_subgrad/l1_subgrad.html LASSO ????????>?
%
% ???LASSO ?????????? 
% <../LASSO_con/LASSO_con.html LASSO ??????>?
%
% ?????????? <../download_code/pm_bp/demo_cont.m demo_cont.m>?
%% ????
% ?????????????????????????????????
% ??????????????????????????????
%
% ????? (C) 2020 ??????????
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%     Copyright (C) 2020 Zaiwen Wen, Haoyang Liu, Jiang Hu
% 
%     This program is free software: you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation, either version 3 of the License, or
%     (at your option) any later version.
% 
%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.
% 
%     You should have received a copy of the GNU General Public License
%     along with this program.  If not, see <https://www.gnu.org/licenses/>.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% ???????????ADMM?? LASSO ??
% ??LASSO ?? 
% 
% $$\min_x \mu\|x\|_1+\frac{1}{2}\|Ax-b\|_2^2.$$
% 
% ?????? ADMM ??????????? ADMM ????
%
% $$ 
% \begin{array}{rl}
% \displaystyle\min_{x,z} & \hspace{-0.5em}\frac{1}{2}\|Ax-b\|^2_2+\mu\|z\|_1,\\
% \displaystyle\mathrm{s.t.} & \hspace{-0.5em}x=z,
% \end{array} 
% $$
%
% ????? ADMM ????????? LASSO ????
%
% $$ 
% \begin{array}{rl}
% \displaystyle\min_y & \hspace{-0.5em}b^\top y+\frac{1}{2}\|y\|_2^2,\\
% \displaystyle\mathrm{s.t.} & \hspace{-0.5em}\|A^\top y\|_\infty\le\mu,
% \end{array}
% $$
%
% ????
%
% $$ 
% \begin{array}{rl}
% \displaystyle\min_{y,z} & \hspace{-0.5em}b^\top y +\frac{1}{2}\|y\|_2^2+I_{\|z\|_\infty\le\mu}(z),\\
% \displaystyle\mathrm{s.t.} & \hspace{-0.5em}A^\top y + z = 0.
% \end{array}
% $$
%
% ????????????? ADMM ???
%% ?? LASSO ??
% ???????
clear;close all;clc;dbstop if error;
seed = 97006855;
ss = RandStream('mt19937ar','Seed',seed);
RandStream.setGlobalStream(ss);
%%%
% ?? LASSO ????
% 
% $$\displaystyle\min_x \frac{1}{2}\|Ax-b\|_2^2+\mu\|x\|_1.$$
% 
% ??????? $A$ ??? $u$ ??? $b=Au$? ????? $\mu=10^{-3}$? ????????
m = 512;
n = 1024;
A = randn(m, n);
u = sprandn(n, 1, 0.1);
b = A * u;
x0 = randn(n, 1);
mu = 1e-3;
%% ?? ADMM ?? LASSO ??
% ?????????????????????????????????????????? $f^*$?
opts = struct();
opts.verbose = 0;
opts.maxit = 2000;
opts.sigma = 1e-2;
opts.ftol = 1e-12; 
opts.gtol = 1e-15;
[x, out] = LASSO_admm_primal(x0, A, b, mu, opts);
f_star = min(out.fvec); 
%%%
% ?? ADMM ?? LASSO ?????
opts = struct();
opts.verbose = 0;
opts.maxit = 2000;
opts.sigma = 1e2;
opts.ftol = 1e-8; 
opts.gtol = 1e-10;
[x, out] = LASSO_admm_dual(x0, A, b, mu, opts);
data1 = (out.fvec - f_star)/f_star;
k1 = length(data1);
%%%
% ?? ADMM ?? LASSO ????
opts = struct();
opts.verbose = 0;
opts.maxit = 2000;
opts.sigma = 1e-2;
opts.ftol = 1e-8; 
opts.gtol = 1e-10;
[x, out] = LASSO_admm_primal(x0, A, b, mu, opts);
data2 = (out.fvec - f_star)/f_star;
k2 = length(data2);
%% ?????
% ???????????????????????????
fig = figure;
semilogy(0:k1-1, data1, '-', 'Color',[0.2 0.1 0.99], 'LineWidth',2);
hold on
semilogy(0:k2-1, data2, '-.','Color',[0.99 0.1 0.2], 'LineWidth',1.5);
legend('ADMM dual','ADMM primal');
ylabel('$(f(x^k) - f^*)/f^*$', 'fontsize', 14, 'interpreter', 'latex');
xlabel('iter times');
print(fig, '-depsc','admm.eps');
%% ????
% ??????? ADMM ?? LASSO ?????????????????????????????
% ?? ADMM ????????????????????????ADMM ????????
% ??? ADMM ?????????????????????????? ADMM
% ????????????????????????????????????????? ADMM
% ????????????
%% ????
% ?????? <LASSO_admm_primal.html ??????????? LASSO ???> ?
% <LASSO_admm_dual.html ??????????? LASSO ????>?
%
% ?????????? <../download_code/lasso_admm/demo_admm.m demo_admm.m>?
%% ????
% ?????????????????????????????????
% ??????????????????????????????
%
% ????? (C) 2020 ??????????